---
title: "Trying to Weight the K Means"
output: html_notebook
---

---
title: "TR2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Let B denote bipartisan matrix(the First one)
### Let P denote partisan matrix(the second one)
### Let F denote full matrix(the third one)


```{r cars}
library(readr)
library(ggplot2)
library(dplyr)
```


### The bipartisan matrix
```{r, echo=FALSE}
matrix<-read.csv("fullmatrix.csv")

B<-as.matrix(matrix[1:429,4:9])
btb<-t(B)%*%B
btb
eigen(btb)
```

```{r}
bu1<-svd(btb)$u[,1]/norm(svd(btb)$u[,1],'2') #normalized dominate eigenvector
bu2<-svd(btb)$u[,2]/norm(svd(btb)$u[,2], '2') #normalized second eigenvector
btbval <- svd(btb)$d
head(bu1)

```

```{r}
btbval/sum(btbval)
```
In this case, we found that the dominant eigenvector accounts for over 78% of the voting matrix, the second vector account for over 13% of the voting matrix, along with the other eigenvectors that each account for less than 5% of the matrix.

To get v1 and v2:
```{r}
bbt <- B %*% t(B)
bv1 <- eigen(bbt)$vectors[,1]/norm(eigen(bbt)$vectors[,1],'2') #normalized v1
bv2 <- eigen(bbt)$vectors[,2]/norm(eigen(bbt)$vectors[,2],'2') #normalized v2

marijuana <- data.frame(
  name = matrix[1:429,2],
  party = matrix[1:429,3],
  bv1 = bv1,
  bv2 = bv2
)


ggplot() + 
  geom_jitter(data = marijuana, aes(x = bv1, y = bv2, color = party),size=1,height=.005,width=.005) +
  scale_color_manual(values = c("Democrat" = "blue", "Republican" = "red"))

```


We can use the dominant and the second eigenvectors to approximate our voting matrix B, which gives us:
```{r, results='hide'}
Bappro <- sqrt(eigen(btb)$values[1]) * bu1 %*% t(bv1) + sqrt(eigen(btb)$values[2]) * bu2 %*% t(bv2)
Bappro
```


### The partisan matrix
```{r, results='hide'}
P<-as.matrix(matrix[1:429,10:24])
ptp<-t(P)%*%P
ptp
eigen(ptp)

pu1<-svd(ptp)$u[,1]/norm(svd(ptp)$u[,1],'2') #normalized dominate eigenvector
pu2<-svd(ptp)$u[,2]/norm(svd(ptp)$u[,2],'2') #normalized second eigenvector
ptpval <- svd(ptp)$d
```

```{r}
ptpval/sum(ptpval)
```
In this case, we found that the dominant eigenvector accounts for over 85% of the voting matrix, the second vector account for over 6% of the voting matrix, along with the other eigenvectors that each account for less than 1% of the matrix.

To get v1 and v2:
```{r}
ppt <- P %*% t(P)
pv1 <- eigen(ppt)$vectors[,1]/norm(eigen(ppt)$vectors[,1],'2')*eigen(ppt)$values[1] #weighted v1
pv2 <- eigen(ppt)$vectors[,2]/norm(eigen(ppt)$vectors[,2],'2')*eigen(ppt)$values[2] #weighted v2
pv3 <- eigen(ppt)$vectors[,3]/norm(eigen(ppt)$vectors[,3],'2')*eigen(ppt)$values[3] #weighted v3
pv4 <- eigen(ppt)$vectors[,4]/norm(eigen(ppt)$vectors[,4],'2')*eigen(ppt)$values[4] #weighted v4
controversial <- data.frame(
  name = matrix[1:429,2],
  party = matrix[1:429,3],
  pv1 = pv1,
  pv2 = pv2,
  pv3 = pv3,
  pv4 = pv4
)
```

```{r}
controversial_k<-controversial%>% 
  select(pv1,pv2,pv3,pv4)
set.seed(169)
kclust_controversial<-kmeans((controversial_k),centers=6)
kclust_controversial1<-kmeans((controversial_k),centers=4)
head(kclust_controversial)


controversial<-controversial%>%
  mutate(kclust_controversial2=as.factor(kclust_controversial$cluster))%>%
  mutate(kclust_controversial3=as.factor(kclust_controversial1$cluster))
  
ggplot(controversial,aes(pv1,pv2)) + 
  geom_jitter(aes(color = kclust_controversial2),size=1,height=2,width=10) 
ggplot(controversial,aes(pv1,pv2)) + 
  geom_jitter(aes(color = kclust_controversial3),size=1,height=2,width=10) 
```

```{r}
dist_mat_scaled<-dist((controversial_k))
hc_complete<-hclust(dist_mat_scaled,method="complete")
plot(hc_complete)
controversial<-controversial%>%
  mutate(hclust_height150=factor(cutree(hc_complete,h=150)))
ggplot(controversial,aes(pv1,pv2)) + 
  geom_jitter(aes(color = hclust_height150),size=1,width=10,height=2)
```
```{r}
dist_mat_scaled<-dist((controversial_k))
hc_complete<-hclust(dist_mat_scaled,method="complete")
plot(hc_complete)
controversial<-controversial%>%
  mutate(hclust_height100=factor(cutree(hc_complete,h=100)))
ggplot(controversial,aes(pv1,pv2)) + 
  geom_jitter(aes(color = hclust_height100),size=1,width=10,height=2)
```

```{r}
Ful<-as.matrix(matrix[1:429,4:24])
ftf<-t(Ful)%*%Ful
ftf
eigen(ftf)

fu1<-svd(ftf)$u[,1]/norm(svd(ftf)$u[,1],'2') #normalized dominate eigenvector
fu2<-svd(ftf)$u[,2]/norm(svd(ftf)$u[,2],'2') #normalized second eigenvector
ftfval <- svd(ftf)$d
head(fu1)


ftfval/sum(ftfval)

fft <- Ful %*% t(Ful)
fv1 <- eigen(fft)$vectors[,1]/norm(eigen(fft)$vectors[,1],'2') #normalized v1
fv1
fv2 <- eigen(fft)$vectors[,2]/norm(eigen(fft)$vectors[,2],'2') #normalized v2

full <- data.frame(
  party = matrix[1:429,3],
  fv1 = fv1,
  fv2 = fv2
)

full <- full %>%
  mutate(hclust_height3=factor(cutree(hc_complete,h=150)))%>%
  mutate(kclust_controversial2=as.factor(kclust_controversial$cluster))
  
ggplot() + 
  geom_jitter(data = full, aes(x = fv1, y = fv2, color = hclust_height3,label=controversial$name),size=2,width=.005,height=.005)

ggplot() + 
  geom_jitter(data = full, aes(x = fv1, y = fv2, color = kclust_controversial2,label=controversial$name),size=2,width=.005,height=.005)
```
